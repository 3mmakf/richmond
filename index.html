<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Our Christmas Week in Richmond</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Vintage-ish Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">

  <style>
    :root {
      /* pastel vintage christmas palette (option C) */
      --bg-paper: #fffaf4;         /* warm ivory */
      --deep-green: #3b6455;       /* soft sage/hunter mix */
      --deep-red: #c84b5a;         /* cherry/rose red */
      --soft-pink: #f5d3dc;        /* ballet pink */
      --gold: #e7c3a1;             /* warm champagne */
      --ink: #2a2520;
      --card-border: #e3cfba;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      width: 100%;
      height: 100%;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      /* candy-stripe wrapping paper background */
      background-image: url('stripebackground.jpg');
      background-repeat: repeat;
      background-size: 260px auto;
      background-color: #fbecee;
      color: var(--ink);
      line-height: 1.6;
      padding: 1.4rem 0.75rem 2rem;
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
    }

    .page {
      max-width: 960px;
      width: 100%;
      margin: 0 auto;
      position: relative;
    }

    .frame {
      position: relative;
      border-radius: 28px;
      padding: 2.2rem 1.5rem 2.4rem;
      background: var(--bg-paper);

      /* your bow border artwork */
      background-image: url('bow-border.jpg');
      background-size: 100% 100%;
      background-repeat: no-repeat;
      background-position: center;

      box-shadow:
        0 24px 60px rgba(0,0,0,0.15),
        0 0 0 1px rgba(255,255,255,0.8) inset;
    }

    .page-inner {
      position: relative;
      z-index: 1;
    }

    header {
      text-align: center;
      margin-bottom: 1.6rem;
    }

    .header-image-wrap {
      max-width: 100%;
      margin: 0 auto 1.6rem;
    }

    .header-image-wrap img {
      width: 100%;
      height: auto;
      display: block;
      border-radius: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.18);
    }

    .main-title {
      font-family: 'Playfair Display', serif;
      font-size: clamp(1.6rem, 2.4vw + 1rem, 2.3rem);
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--deep-green);
      margin-bottom: 0.35rem;
    }

    header .sub {
      margin-top: 0.25rem;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      color: rgba(0,0,0,0.7);
    }

    .banner-wrap {
      display: inline-block;
      position: relative;
      padding: 0.65rem 1.7rem;
      max-width: 100%;
      margin-bottom: 0.25rem;
    }

    .banner {
      font-family: 'Playfair Display', serif;
      font-size: clamp(1.4rem, 2.2vw + 1rem, 2.1rem);
      letter-spacing: 0.11em;
      text-transform: uppercase;
      color: var(--deep-green);
      position: relative;
      z-index: 1;
      white-space: normal;
      line-height: 1.3;
    }

    .banner-wrap::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 999px;
      background: linear-gradient(135deg, #fbe8e8, #fffaf4);
      border: 2px solid var(--deep-green);
      transform: none;
      box-shadow: 0 10px 22px rgba(0,0,0,0.18);
    }

    .banner-wrap::after {
      position: absolute;
      top: -1.1rem;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.8rem;
      letter-spacing: 0.4em;
      color: var(--gold);
      white-space: nowrap;
    }

    .divider {
      margin: 1.5rem auto 1.7rem;
      max-width: 640px;
      height: 1px;
      background-image: linear-gradient(
        to right,
        transparent 0,
        rgba(0,0,0,0.28) 15%,
        rgba(0,0,0,0.28) 85%,
        transparent 100%
      );
      position: relative;
    }

    .divider::before,
    .divider::after {
      content: "‚ú∂";
      position: absolute;
      top: -0.7rem;
      font-size: 0.9rem;
      color: var(--deep-red);
    }

    .divider::before { left: 0.6rem; }
    .divider::after  { right: 0.6rem; }

    .days {
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
    }

    .day-card {
      position: relative;
      background: #ffe5ef;
      border-radius: 24px;
      padding: 1.4rem 1.2rem 1.4rem;
      box-shadow:
        0 14px 32px rgba(0,0,0,0.08),
        0 0 0 1px rgba(255,255,255,0.8) inset;
      overflow: hidden;
    }

    .day-card::before {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 24px;
      border: 3px solid var(--deep-green);
      transform: none;
      pointer-events: none;
      opacity: 0.9;
    }

    .day-inner {
      position: relative;
      z-index: 1;
    }

    .day-heading {
      display: flex;
      align-items: center;
      gap: 0.45rem;
      margin-bottom: 0.3rem;
      flex-wrap: wrap;
    }

    .day-emoji {
      font-size: 1.3rem;
    }

    .day-title {
      font-family: 'Playfair Display', serif;
      text-transform: uppercase;
      font-size: 1.2rem;
      letter-spacing: 0.22em;
      margin-bottom: 0.25rem;
    }

    .day-toggle {
      position: absolute;
      top: 0.7rem;
      right: 0.8rem;
      padding: 0.15rem 0.6rem;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.12);
      background: rgba(255,255,255,0.85);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      cursor: pointer;
      color: rgba(0,0,0,0.7);
      -webkit-appearance: none;
      appearance: none;
    }

    .day-toggle:hover,
    .day-toggle:active {
      color: rgba(0,0,0,0.9);
      background: #fff;
    }

    .day-card.collapsed .day-content {
      display: none;
    }

    .day-tuesday::before,
    .day-thursday::before,
    .day-saturday::before {
      border-color: var(--deep-green);
    }
    .day-wednesday::before,
    .day-friday::before {
      border-color: var(--deep-red);
    }

    .day-tuesday .day-title,
    .day-thursday .day-title,
    .day-saturday .day-title {
      color: var(--deep-green);
    }
    .day-wednesday .day-title,
    .day-friday .day-title {
      color: var(--deep-red);
    }

    .day-subtitle {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: rgba(0,0,0,0.6);
      margin-bottom: 0.5rem;
    }

    .checklist {
      list-style: none;
      padding-left: 0;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .checklist li {
      margin: 0;
      padding: 0;
    }

    .check {
      display: flex;
      align-items: flex-start;
      gap: 0.55rem;
      cursor: pointer;
      font-size: 0.95rem;
      position: relative;
    }

    .check input {
      position: absolute;
      opacity: 0;
      pointer-events: none;
    }

    .box {
      width: 18px;
      height: 18px;
      border-radius: 4px;
      border: 2px solid var(--deep-green);
      flex-shrink: 0;
      margin-top: 2px;
      background: rgba(255,255,255,0.95);
      box-shadow: 0 1px 0 rgba(0,0,0,0.08);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      color: white;
    }

    .check input:checked + .box {
      background: linear-gradient(135deg, var(--deep-green), #5d8d7c);
      border-color: #29493d;
    }

    .check input:checked + .box::after {
      content: "‚úì";
    }

    .check .text {
      flex: 1;
    }

    .nested-list {
      margin-top: 0.4rem;
      margin-left: 1.6rem;
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
    }

    .nested-list .check .box {
      border-color: var(--deep-red);
    }

    .nested-list .check input:checked + .box {
      background: linear-gradient(135deg, var(--deep-red), #e37483);
      border-color: #8d313d;
    }

    .day-move {
      margin-top: 0.6rem;
      margin-left: auto;
      display: inline-block;
      border: none;
      background: none;
      padding: 0;
      font-size: 0.75rem;
      letter-spacing: 0.06em;
      color: rgba(0,0,0,0.6);
      cursor: pointer;
    }

    .day-move:hover {
      text-decoration: underline;
      color: var(--deep-green);
    }

    footer {
      margin-top: 1.8rem;
      text-align: center;
      font-size: 0.78rem;
      color: rgba(0,0,0,0.65);
    }

    footer .heart {
      color: var(--deep-red);
    }

    .collage {
      margin-top: 2rem;
      padding-top: 1.2rem;
      border-top: 1px dashed rgba(0,0,0,0.15);
    }

    .collage-title {
      font-family: 'Playfair Display', serif;
      font-size: 1.1rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      text-align: center;
      color: var(--deep-green);
      margin-bottom: 0.2rem;
    }

    .collage-caption {
      font-size: 0.8rem;
      text-align: center;
      color: rgba(0,0,0,0.55);
      margin-bottom: 0.8rem;
      text-transform: lowercase;
    }

    .collage-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      justify-content: center;
      min-height: 1.5rem;
    }

    .collage-grid img {
      width: 90px;
      height: 90px;
      object-fit: cover;
      border-radius: 14px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.18);
      border: 2px solid #fff;
    }

    @media (max-width: 640px) {
      body {
        padding: 1.1rem 0.4rem 1.6rem;
      }

      .frame {
        padding: 1.7rem 0.9rem 1.9rem;
        border-radius: 24px;
      }

      .banner-wrap {
        padding: 0.55rem 1.3rem;
      }

      .banner {
        font-size: 1.35rem;
      }

      header .sub {
        font-size: 0.72rem;
        letter-spacing: 0.18em;
      }

      .day-card {
        padding: 1rem 0.85rem 2rem;
        border-radius: 14px;
      }

      .check {
        font-size: 0.9rem;
      }

      .box {
        width: 17px;
        height: 17px;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="frame">
      <div class="page-inner">
        <header>
          <div class="header-image-wrap">
            <img src="background.png" alt="Caroline & Emma Christmas Collage" />
          </div>

          <div class="banner-wrap">
            <div class="banner">
              üå≤ Our Christmas Week in Richmond üå≤
            </div>
          </div>

          <div class="sub">
            cozy plans ¬∑ twinkly lights ¬∑ little memories
          </div>
        </header>

        <div class="divider"></div>

        <main class="days">
          <!-- TUESDAY -->
          <section class="day-card day-tuesday" data-day-id="tuesday">
            <div class="day-inner">
              <div class="day-heading">
                <div class="day-emoji">üéÅ</div>
                <div class="day-title">Tuesday</div>
              </div>
              <button class="day-toggle" type="button">Hide details ‚úø</button>
              <div class="day-content">
                <div class="day-subtitle">arrival ¬∑ cake ¬∑ christmas pjs</div>
                <ul class="checklist">
                  <li>
                    <label class="check">
                      <input type="checkbox" data-item-id="tue_caroline" />
                      <span class="box"></span>
                      <span class="text">Caroline arrives!!</span>
                    </label>
                  </li>
                  <li>
                    <label class="check">
                      <input type="checkbox" data-item-id="tue_housewives" />
                      <span class="box"></span>
                      <span class="text">Real Housewives + give gifts</span>
                    </label>
                  </li>
                  <li>
                    <label class="check">
                      <input type="checkbox" data-item-id="tue_dinner" />
                      <span class="box"></span>
                      <span class="text">Dinner: Honey Garlic Chicken, rice &amp; broccoli</span>
                    </label>
                  </li>
                  <li>
                    <label class="check">
                      <input type="checkbox" data-item-id="tue_cake" />
                      <span class="box"></span>
                      <span class="text">Shyndigz cake üç∞</span>
                    </label>
                  </li>
                  <li>
                    <label class="check">
                      <input type="checkbox" data-item-id="tue_pjs" />
                      <span class="box"></span>
                      <span class="text">Christmas pajamas üéÄ</span>
                    </label>
                  </li>
                </ul>
                <button class="day-move" type="button">
                  Move to another day ‚Üí
                </button>
              </div>
            </div>
          </section>

          <!-- WEDNESDAY -->
          <section class="day-card day-wednesday" data-day-id="wednesday">
            <div class="day-inner">
              <div class="day-heading">
                <div class="day-emoji">üè†</div>
                <div class="day-title">Wednesday</div>
              </div>
              <button class="day-toggle" type="button">Hide details ‚úø</button>
              <div class="day-content">
                <div class="day-subtitle">gingerbread ¬∑ lights ¬∑ hotel trees</div>
                <ul class="checklist">
                  <li>
                    <label class="check">
                      <input type="checkbox" data-item-id="wed_gingerbread" />
                      <span class="box"></span>
                      <span class="text">Gingerbread houses</span>
                    </label>
                  </li>
                  <li>
                    <label class="check">
                      <input type="checkbox" data-item-id="wed_beauvine" />
                      <span class="box"></span>
                      <span class="text">Beauvine supper &amp; happy hour üçî</span>
                    </label>
                  </li>
                  <li>
                    <label class="check">
                      <input type="checkbox" data-item-id="wed_lights" />
                      <span class="box"></span>
                      <span class="text">The Fan ‚Äî Christmas lights drive</span>
                    </label>
                  </li>
                  <li>
                    <label class="check">
                      <input type="checkbox" data-item-id="wed_hoteltrees" />
                      <span class="box"></span>
                      <span class="text">Hotel Trees:</span>
                    </label>
                  </li>
                </ul>
                <div class="nested-list">
                  <label class="check">
                    <input type="checkbox" data-item-id="wed_jefferson" />
                    <span class="box"></span>
                    <span class="text">Jefferson Hotel Christmas Trees</span>
                  </label>
                  <label class="check">
                    <input type="checkbox" data-item-id="wed_quirk" />
                    <span class="box"></span>
                    <span class="text">Quirk Hotel üå∏</span>
                  </label>
                </div>
                <button class="day-move" type="button">
                  Move to another day ‚Üí
                </button>
              </div>
            </div>
          </section>

          <!-- THURSDAY -->
          <section class="day-card day-thursday" data-day-id="thursday">
            <div class="day-inner">
              <div class="day-heading">
                <div class="day-emoji">üé¨</div>
                <div class="day-title">Thursday</div>
              </div>
              <button class="day-toggle" type="button">Hide details ‚úø</button>
              <div class="day-content">
                <div class="day-subtitle">carytown ¬∑ cocktails ¬∑ elf at the byrd</div>
                <ul class="checklist">
                  <li>
                    <label class="check">
                      <input type="checkbox" data-item-id="thu_carytown" />
                      <span class="box"></span>
                      <span class="text">Carytown browsing üéÅ</span>
                    </label>
                  </li>
                  <li>
                    <label class="check">
                      <input type="checkbox" data-item-id="thu_dinner" />
                      <span class="box"></span>
                      <span class="text">Dinner in Carytown: Greek on Cary</span>
                    </label>
                  </li>
                  <li>
                    <label class="check">
                      <input type="checkbox" data-item-id="thu_drinks" />
                      <span class="box"></span>
                      <span class="text">Miracle on Cary ‚Äî holiday drinks</span>
                    </label>
                  </li>
                  <li>
                    <label class="check">
                      <input type="checkbox" data-item-id="thu_elf" />
                      <span class="box"></span>
                      <span class="text">The Byrd Theatre ‚Äî ELF (7‚Äì10 PM)</span>
                    </label>
                  </li>
                </ul>
                <button class="day-move" type="button">
                  Move to another day ‚Üí
                </button>
              </div>
            </div>
          </section>

          <!-- FRIDAY -->
          <section class="day-card day-friday" data-day-id="friday">
            <div class="day-inner">
              <div class="day-heading">
                <div class="day-emoji">üé≠</div>
                <div class="day-title">Friday</div>
              </div>
              <button class="day-toggle" type="button">Hide details ‚úø</button>
              <div class="day-content">
                <div class="day-subtitle">cocktails ¬∑ a christmas carol</div>
                <ul class="checklist">
                  <li>
                    <label class="check">
                      <input type="checkbox" data-item-id="fri_salad" />
                      <span class="box"></span>
                      <span class="text">Caesar salad &amp; crispy chicken (or Caesar &amp; pizza) ü•óüçï</span>
                    </label>
                  </li>
                  <li>
                    <label class="check">
                      <input type="checkbox" data-item-id="fri_evergreen" />
                      <span class="box"></span>
                      <span class="text">Evergreen at Birdie‚Äôs ‚Äî Christmas cocktails üç∏</span>
                    </label>
                  </li>
                  <li>
                    <label class="check">
                      <input type="checkbox" data-item-id="fri_carol" />
                      <span class="box"></span>
                      <span class="text">A Christmas Carol ‚Äî 7 PM</span>
                    </label>
                  </li>
                </ul>
                <button class="day-move" type="button">
                  Move to another day ‚Üí
                </button>
              </div>
            </div>
          </section>

          <!-- SATURDAY -->
          <section class="day-card day-saturday" data-day-id="saturday">
            <div class="day-inner">
              <div class="day-heading">
                <div class="day-emoji">üö§</div>
                <div class="day-title">Saturday</div>
              </div>
              <button class="day-toggle" type="button">Hide details ‚úø</button>
              <div class="day-content">
                <div class="day-subtitle">market ¬∑ river ¬∑ parade of lights</div>
                <ul class="checklist">
                  <li>
                    <label class="check">
                      <input type="checkbox" data-item-id="sat_market" />
                      <span class="box"></span>
                      <span class="text">Studio Two Three Winter Market üéÅ</span>
                    </label>
                  </li>
                  <li>
                    <label class="check">
                      <input type="checkbox" data-item-id="sat_boat" />
                      <span class="box"></span>
                      <span class="text">Boat Parade of Lights ‚Äî Rocketts Landing (5 PM) ‚ú®</span>
                    </label>
                  </li>
                </ul>
                <button class="day-move" type="button">
                  Move to another day ‚Üí
                </button>
              </div>
            </div>
          </section>
        </main>

        <section class="collage" id="photo-collage">
          <h2 class="collage-title">little memory collage</h2>
          <p class="collage-caption">photos from the moments we checked off ‚úø</p>
          <div class="collage-grid" id="photo-collage-grid"></div>
        </section>

        <footer>
          Made with <span class="heart">‚ô•</span> for Caroline &amp; Emma‚Äôs Christmas week in Richmond.
        </footer>
      </div>
    </div>
  </div>

  <!-- hidden file input for taking/choosing photos -->
  <input
    type="file"
    id="photo-capture"
    accept="image/*"
    capture="environment"
    style="display:none"
  />

  <!-- Firebase SDKs (compat) -->
  <script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-database-compat.js"></script>

  <script>
    // üî¥ REPLACE THESE VALUES WITH YOUR ACTUAL FIREBASE CONFIG
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>

  <script>
    (function () {
      document.addEventListener('DOMContentLoaded', function () {
        const dayCards = Array.from(document.querySelectorAll('.day-card'));
        const dayLists = {};

        dayCards.forEach(card => {
          const id = card.dataset.dayId;
          const list = card.querySelector('.checklist');
          if (id && list) {
            dayLists[id] = list;
          }
        });

        const photoInput  = document.getElementById('photo-capture');
        const collageSect = document.getElementById('photo-collage');
        const collageGrid = document.getElementById('photo-collage-grid');

        const allCheckboxes = Array.from(
          document.querySelectorAll('.check input[type="checkbox"]')
        );

        const checkboxGroups = {};
        allCheckboxes.forEach((box, index) => {
          const itemId = box.dataset.itemId || ('box_' + index);
          if (!checkboxGroups[itemId]) {
            checkboxGroups[itemId] = [];
          }
          checkboxGroups[itemId].push(box);
        });

        // Firebase refs
        const checksRef   = db.ref('checkState');
        const taskDayRef  = db.ref('taskDayState');
        const daysRef     = db.ref('dayState');
        const photosRef   = db.ref('photos');

        let checkState   = {};
        let taskDayState = {};
        let dayState     = {};
        let photoState   = [];
        let activePhotoTask = null;

        function renderCollage() {
          if (!collageSect || !collageGrid) return;
          collageSect.style.display = 'block';
          collageGrid.innerHTML = '';

          if (!photoState || photoState.length === 0) {
            const msg = document.createElement('p');
            msg.textContent = 'no photos yet ‚Äî check something off and add one ‚úø';
            msg.style.fontSize = '0.8rem';
            msg.style.textAlign = 'center';
            msg.style.color = 'rgba(0,0,0,0.5)';
            collageGrid.appendChild(msg);
            return;
          }

          photoState.forEach(p => {
            if (!p || !p.dataUrl) return;
            const img = document.createElement('img');
            img.src = p.dataUrl;
            img.alt = p.label || 'memory photo';
            collageGrid.appendChild(img);
          });
        }

        // Photos: subscribe to Firebase
        photosRef.on('value', (snapshot) => {
          const data = snapshot.val();
          if (Array.isArray(data)) {
            photoState = data;
          } else if (data && typeof data === 'object') {
            photoState = Object.values(data);
          } else {
            photoState = [];
          }
          renderCollage();
        });

        if (photoInput) {
          photoInput.addEventListener('change', function () {
            const file = this.files && this.files[0];
            if (!file || !activePhotoTask) {
              this.value = '';
              return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
              const dataUrl = e.target.result;
              if (!dataUrl) return;

              const newPhoto = {
                id: 'p_' + Date.now() + '_' + Math.random().toString(36).slice(2),
                taskId: activePhotoTask.itemId,
                label: activePhotoTask.labelText,
                dataUrl: dataUrl,
                ts: Date.now()
              };

              photoState.push(newPhoto);
              photosRef.set(photoState);
            };
            reader.readAsDataURL(file);

            activePhotoTask = null;
            photoInput.value = '';
          });
        }

        // Task day mapping: subscribe
        taskDayRef.on('value', (snapshot) => {
          taskDayState = snapshot.val() || {};

          // re-move tasks according to mapping
          allCheckboxes.forEach((box, index) => {
            const itemId = box.dataset.itemId || ('box_' + index);
            const savedDay = taskDayState[itemId];
            if (!savedDay) return;

            const li = box.closest('li');
            const currentCard = box.closest('.day-card');
            const currentDayId = currentCard ? currentCard.dataset.dayId : null;

            const targetList = dayLists[savedDay];
            if (li && targetList && savedDay !== currentDayId) {
              targetList.appendChild(li);
            }
          });
        });

        // Checkbox state: subscribe
        checksRef.on('value', (snapshot) => {
          checkState = snapshot.val() || {};
          allCheckboxes.forEach((box, index) => {
            const itemId = box.dataset.itemId || ('box_' + index);
            box.checked = !!checkState[itemId];
          });
        });

        // Checkbox change handler
        allCheckboxes.forEach((box, index) => {
          const itemId = box.dataset.itemId || ('box_' + index);

          box.addEventListener('change', () => {
            const wasChecked   = !!checkState[itemId];
            const isNowChecked = box.checked;

            checkState[itemId] = isNowChecked;
            checksRef.set(checkState);

            const group = checkboxGroups[itemId] || [];
            group.forEach(other => {
              if (other !== box) {
                other.checked = isNowChecked;
              }
            });

            if (!wasChecked && isNowChecked && photoInput) {
              const labelEl = box.closest('.check')?.querySelector('.text');
              const labelText = labelEl ? labelEl.textContent.trim() : 'this moment';

              const ok = confirm(
                `Do you want to take a photo for:\n‚Äú${labelText}‚Äù?`
              );
              if (ok) {
                activePhotoTask = { itemId, labelText };
                photoInput.click();
              }
            }
          });
        });

        // Collapsible days: subscribe
        const toggleButtons = [];
        dayCards.forEach((card, cardIndex) => {
          const dayId = card.dataset.dayId || ('day_' + cardIndex);
          const toggleBtn = card.querySelector('.day-toggle');
          const content = card.querySelector('.day-content');

          if (!toggleBtn || !content) return;

          toggleButtons.push({ card, dayId, toggleBtn, content });

          toggleBtn.addEventListener('click', () => {
            card.classList.toggle('collapsed');
            dayState[dayId] = card.classList.contains('collapsed');
            daysRef.set(dayState);
          });
        });

        daysRef.on('value', (snapshot) => {
          dayState = snapshot.val() || {};
          toggleButtons.forEach(({ card, dayId, toggleBtn }) => {
            if (dayState[dayId]) {
              card.classList.add('collapsed');
            } else {
              card.classList.remove('collapsed');
            }

            if (card.classList.contains('collapsed')) {
              toggleBtn.textContent = 'Show day ‚úø';
            } else {
              toggleBtn.textContent = 'Hide details ‚úø';
            }
          });
        });

        // Move to another day: sync mapping
        dayCards.forEach(card => {
          const moveBtn = card.querySelector('.day-move');
          if (!moveBtn) return;

          moveBtn.addEventListener('click', () => {
            const allChecksInCard = card.querySelectorAll('.check input[type="checkbox"]');
            const unchecked = Array.from(allChecksInCard).filter(cb => !cb.checked);

            if (unchecked.length === 0) {
              alert('Everything in this day is already checked off! ‚ú®');
              return;
            }

            let answer = prompt(
              'Move all UNCHECKED tasks from this day to which day?\n' +
              'Type: Tuesday, Wednesday, Thursday, Friday, or Saturday.'
            );
            if (!answer) return;

            answer = answer.trim().toLowerCase();

            let targetDay = null;
            if (answer.startsWith('tue')) targetDay = 'tuesday';
            else if (answer.startsWith('wed')) targetDay = 'wednesday';
            else if (answer.startsWith('thu')) targetDay = 'thursday';
            else if (answer.startsWith('fri')) targetDay = 'friday';
            else if (answer.startsWith('sat')) targetDay = 'saturday';

            if (!targetDay) {
              alert('I didn‚Äôt recognize that day. Try Tuesday, Wednesday, Thursday, Friday, or Saturday.');
              return;
            }

            const targetCard = document.querySelector('.day-card[data-day-id="' + targetDay + '"]');
            if (!targetCard) {
              alert('I couldn‚Äôt find that day on the page.');
              return;
            }

            const targetList = targetCard.querySelector('.checklist');
            if (!targetList) {
              alert('That day doesn‚Äôt have a checklist to move into.');
              return;
            }

            unchecked.forEach((cb, idx) => {
              const li = cb.closest('li');
              if (!li) return;
              targetList.appendChild(li);

              const itemId = cb.dataset.itemId || ('box_' + idx);
              taskDayState[itemId] = targetDay;
            });

            taskDayRef.set(taskDayState);
          });
        });
      });
    })();
  </script>
</body>
</html>

